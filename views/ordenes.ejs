<%- include ("./partials/cabecera") %> 
<%- rolAdmin!=false?include("./partials/navbar"):include("./partials/navbarUser")%> 


<style>
   
@media (max-width: 600px) {
    .formulario{
      width: 100%;
    }
}
    

    .conten{
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    font-size: 16px;
    line-height: 1.42857143;
    color: #333333;
    font-family: 'Poppins', sans-serif;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    position: relative;
    min-height: 1px;
    padding-left: 15px;
    padding-right: 15px;
    float: left;
    width: 50%;
    }

    .formulario{
        -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    font-size: 16px;
    line-height: 1.42857143;
    color: #333333;
    font-family: 'Poppins', sans-serif;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    margin-bottom: 10px;
    margin-top: 35px;
    }

    @media (max-width: 600px) {
        .formulario{
          width: 70%;
        }
    }


</style>
 

    <div class="text-center m-auto">
    
        <form class="container formulario col-3 m-auto" action="/ordenes" method="post"  enctype="multipart/form-data">
            <h1 class="h3 mb-3 fw-normal text-info"><b>Nueva orden</b></h1>

            <div class="m-2 bg-warning text-center rounded-top rounded-bottom">
              <li class="text-success p-2" style="list-style:none;"><b>Mi saldo $ <%= saldo %> CLP</b></li>
            </div>

            <div class="form-floating text-dark mt-5">
              <h4 class="text-info"><b>Categoria</b></h4>
              <p>
                <% for(i=0;i<categorias.length;i++){ %> 
            
                <input type="radio" id="categoria" name="categoria" value="<%= categorias[i]  %>" >  <span class="text-light"><%= categorias[i] %></span> <br>
            
                <% } %> 
                  
            
              </p>
              
              
            
            </div>
            
           
            <div class="form-floating text-dark mt-5"id="contenedorservicios">
              <span class="text-info" ><b>Servicios</b></span>
                
              <%# Guardar servicios de cada categoria en un select diferente luego style.visibility hidden %>
              <select class="form-control bg-dark text-info mt-2 text-center" id="facebook" name="servicio"  >
                <option value="" disabled selected>Selecciona un servicio</option>
              </select>

              <select class="form-control bg-dark text-info mt-2 text-center" id="tiktok" name="servicio"  >
                <option value="" disabled selected>Selecciona un servicio</option>
              </select>

              <select class="form-control bg-dark text-info mt-2 text-center" id="instagram" name="servicio"  >
                <option value="" disabled selected>Selecciona un servicio</option>
              </select>

              <select class="form-control bg-dark text-info mt-2 text-center" id="youtube" name="servicio"  >
                <option value="" disabled selected>Selecciona un servicio</option>
              </select>

              <select class="form-control bg-dark text-info mt-2 text-center" id="spotify" name="servicio"  >
                <option value="" disabled selected>Selecciona un servicio</option>
              </select>

              <select class="form-control bg-dark text-info mt-2 text-center" id="twitter" name="servicio"  >
                <option value="" disabled selected>Selecciona un servicio</option>
              </select>

              <select class="form-control bg-dark text-info mt-2 text-center" id="digitales" name="servicio"  >
                <option value="" disabled selected>Selecciona un servicio</option>
              </select>

              <select class="form-control bg-dark text-info mt-2 text-center" id="verificacion" name="servicio"  >
                <option value="" disabled selected>Selecciona un servicio</option>
              </select>

              <select class="form-control bg-dark text-info mt-2 text-center" id="monetizacion" name="servicio"  >
                <option value="" disabled selected>Selecciona un servicio</option>
              </select>

              <select class="form-control bg-dark text-info mt-2 text-center" id="defecto" name="servicio"  >
                <option value="" disabled selected>Selecciona un servicio</option>
              </select>

              <% for(i=0;i<servicios.length;i++){ %> 
                  
                      <script>
                       
                        // select
                        var facebooks = document.getElementById('facebook')
                        var tiktoks = document.getElementById('tiktok')
                        var instagrams = document.getElementById('instagram')
                        var youtubes = document.getElementById('youtube')
                        var spotifys = document.getElementById('spotify')
                        var twitters = document.getElementById('twitter')
                        var Digitaless = document.getElementById('digitales')
                        var verificacions = document.getElementById('verificacion')
                        var monetizacions = document.getElementById('monetizacion')




                        // Facebook
                        var option = document.createElement('option');
                          option.value="<%= servicios[i].Categoria=='Facebook'?servicios[i].id+' '+servicios[i].Precio:'' %>"
                          option.text="<%= servicios[i].Categoria=='Facebook'?servicios[i].Nombre +' '+servicios[i].Descripcion+' '+servicios[i].Precio:'' %>"
                          facebooks.appendChild(option)

                          for (var i = 0; i < facebooks.children.length; ++i) {
                                var child = facebooks.children[i];
                                if(child.text==''){
                                  child.style.display = "none";
                                }
                          }

                          // Tiktok
                        var optiont = document.createElement('option');
                          optiont.value="<%= servicios[i].Categoria=='Tiktok'?servicios[i].id+' '+servicios[i].Precio:'' %>"
                          optiont.text="<%= servicios[i].Categoria=='Tiktok'?servicios[i].Nombre +' '+servicios[i].Descripcion+' '+servicios[i].Precio:'' %>"
                          tiktoks.appendChild(optiont)

                          for (var i = 0; i < tiktoks.children.length; ++i) {
                                var childt = tiktoks.children[i];
                                if(childt.text==''){
                                  childt.style.display = "none";
                                }
                          }

                        // Instagram
                        var optioni = document.createElement('option');

                        optioni.value="<%= servicios[i].Categoria=='Instagram'?servicios[i].id+' '+servicios[i].Precio:'' %>"
                          optioni.text="<%= servicios[i].Categoria=='Instagram'?servicios[i].Nombre +' '+servicios[i].Descripcion+' '+servicios[i].Precio:'' %>"
                          instagrams.appendChild(optioni)

                          for (var i = 0; i < instagrams.children.length; ++i) {
                                var childd = instagrams.children[i];
                                if(childd.text==''){
                                  childd.style.display = "none";
                                }
                          }
                        
                        // Youtube
                        var optiony = document.createElement('option');

                        optiony.value="<%= servicios[i].Categoria=='Youtube'?servicios[i].id+' '+servicios[i].Precio:'' %>"
                          optiony.text="<%= servicios[i].Categoria=='Youtube'?servicios[i].Nombre +' '+servicios[i].Descripcion+' '+servicios[i].Precio:'' %>"
                          youtubes.appendChild(optiony)

                          for (var i = 0; i < youtubes.children.length; ++i) {
                                var childy = youtubes.children[i];
                                if(childy.text==''){
                                  childy.style.display = "none";
                                }
                          }

                          // Spotify
                          var options = document.createElement('option');

                          options.value="<%= servicios[i].Categoria=='Spotify'?servicios[i].id+' '+servicios[i].Precio:'' %>"
                          options.text="<%= servicios[i].Categoria=='Spotify'?servicios[i].Nombre +' '+servicios[i].Descripcion+' '+servicios[i].Precio:'' %>"
                          spotifys.appendChild(options)

                          for (var i = 0; i < spotifys.children.length; ++i) {
                                var childs = spotifys.children[i];
                                if(childs.text==''){
                                  childs.style.display = "none";
                                }
                          }

                          // Twitter
                          var optiont = document.createElement('option');

                          optiont.value="<%= servicios[i].Categoria=='Twitter'?servicios[i].id+' '+servicios[i].Precio:'' %>"
                          optiont.text="<%= servicios[i].Categoria=='Twitter'?servicios[i].Nombre +' '+servicios[i].Descripcion+' '+servicios[i].Precio:'' %>"
                          twitters.appendChild(optiont)

                          for (var i = 0; i < twitters.children.length; ++i) {
                                var childt = twitters.children[i];
                                if(childt.text==''){
                                  childt.style.display = "none";
                                }
                          }

                          // Digitales
                          var optiond = document.createElement('option');

                          optiond.value="<%= servicios[i].Categoria=='Digitales'?servicios[i].id+' '+servicios[i].Precio:'' %>"
                          optiond.text="<%= servicios[i].Categoria=='Digitales'?servicios[i].Nombre +' '+servicios[i].Descripcion+' '+servicios[i].Precio:'' %>"
                          Digitaless.appendChild(optiond)

                          for (var i = 0; i < Digitaless.children.length; ++i) {
                                var childdi = Digitaless.children[i];
                                if(childdi.text==''){
                                  childdi.style.display = "none";
                                }
                          }

                          // Verificacion
                          var optionv = document.createElement('option');

                          optionv.value="<%= servicios[i].Categoria=='Verificación'?servicios[i].id+' '+servicios[i].Precio:'' %>"
                          optionv.text="<%= servicios[i].Categoria=='Verificación'?servicios[i].Nombre +' '+servicios[i].Descripcion+' '+servicios[i].Precio:'' %>"
                          verificacions.appendChild(optionv)

                          for (var i = 0; i < verificacions.children.length; ++i) {
                                var childv = verificacions.children[i];
                                if(childv.text==''){
                                  childv.style.display = "none";
                                }
                          }
                          // Monetizacion
                          var optionm = document.createElement('option');

                          optionm.value="<%= servicios[i].Categoria=='Monetización'?servicios[i].id+' '+servicios[i].Precio:'' %>"
                          optionm.text="<%= servicios[i].Categoria=='Monetización'?servicios[i].Nombre +' '+servicios[i].Descripcion+' '+servicios[i].Precio:'' %>"
                          monetizacions.appendChild(optionm)

                          for (var i = 0; i < monetizacions.children.length; ++i) {
                                var childm = monetizacions.children[i];
                                if(childm.text==''){
                                  childm.style.display = "none";
                                }
                          }

                          

                        var precioServicio;
                        var categoria = document.getElementById('categoria')
                        var servicio = document.getElementById('servicio')

                        facebooks.style.display = 'none';
                        tiktoks.style.display = 'none';
                        instagrams.style.display = 'none';
                        youtubes.style.display = 'none';
                        spotifys.style.display = 'none';
                        twitters.style.display = 'none';
                        Digitaless.style.display = 'none';
                        verificacions.style.display = 'none';
                        monetizacions.style.display = 'none';


                      </script>
                <% } %> 
                
                <script>

                  var categoria = document.getElementsByName('categoria');

                  for (var i = 0; i < categoria.length; i++) {
                    categoria[i].addEventListener("click", handleClick);
                  }


                  function handleClick(event) {
                    var valor = event.target.value;
                    categoria.value=valor

                    var defecto = document.getElementById('defecto')
                    defecto.style.display = 'none'
                    
                    if(categoria.value=='Facebook'){
                      facebooks.style.display = 'flex'

                        tiktoks.style.display = 'none';
                        instagrams.style.display = 'none';
                        youtubes.style.display = 'none';
                        spotifys.style.display = 'none';
                        twitters.style.display = 'none';
                        Digitaless.style.display = 'none';
                        verificacions.style.display = 'none';
                        monetizacions.style.display = 'none';

                    }else if(categoria.value=='Tiktok'){
                        tiktoks.style.display= 'flex'

                        facebooks.style.display = 'none';
                        instagrams.style.display = 'none';
                        youtubes.style.display = 'none';
                        spotifys.style.display = 'none';
                        twitters.style.display = 'none';
                        Digitaless.style.display = 'none';
                        verificacions.style.display = 'none';
                        monetizacions.style.display = 'none';
                      

                    }else if(categoria.value=='Instagram'){
                      instagrams.style.display= 'flex'

                      facebooks.style.display = 'none';
                        tiktoks.style.display = 'none';
                        youtubes.style.display = 'none';
                        spotifys.style.display = 'none';
                        twitters.style.display = 'none';
                        Digitaless.style.display = 'none';
                        verificacions.style.display = 'none';
                        monetizacions.style.display = 'none';

                    }else if(categoria.value=='Youtube'){
                      youtubes.style.display= 'flex'

                      facebooks.style.display = 'none';
                        tiktoks.style.display = 'none';
                        instagrams.style.display = 'none';
                        spotifys.style.display = 'none';
                        twitters.style.display = 'none';
                        Digitaless.style.display = 'none';
                        verificacions.style.display = 'none';
                        monetizacions.style.display = 'none';

                    }else if(categoria.value=='Spotify'){
                      spotifys.style.display= 'flex'

                      facebooks.style.display = 'none';
                        tiktoks.style.display = 'none';
                        instagrams.style.display = 'none';
                        youtubes.style.display = 'none';
                        twitters.style.display = 'none';
                        Digitaless.style.display = 'none';
                        verificacions.style.display = 'none';
                        monetizacions.style.display = 'none';

                    }else if(categoria.value=='Twitter'){
                      twitters.style.display= 'flex'

                      facebooks.style.display = 'none';
                        tiktoks.style.display = 'none';
                        instagrams.style.display = 'none';
                        youtubes.style.display = 'none';
                        spotifys.style.display = 'none';
                        Digitaless.style.display = 'none';
                        verificacions.style.display = 'none';
                        monetizacions.style.display = 'none';

                    }else if(categoria.value=='Cuentas digitales'){
                      Digitaless.style.display= 'flex'

                      facebooks.style.display = 'none';
                        tiktoks.style.display = 'none';
                        instagrams.style.display = 'none';
                        youtubes.style.display = 'none';
                        spotifys.style.display = 'none';
                        twitters.style.display = 'none';
                        verificacions.style.display = 'none';
                        monetizacions.style.display = 'none';

                    }else if(categoria.value=='Verificación'){
                      verificacions.style.display= 'flex'

                      facebooks.style.display = 'none';
                        tiktoks.style.display = 'none';
                        instagrams.style.display = 'none';
                        youtubes.style.display = 'none';
                        spotifys.style.display = 'none';
                        twitters.style.display = 'none';
                        Digitaless.style.display = 'none';
                        monetizacions.style.display = 'none';

                    }else if(categoria.value=='Monetización'){
                      monetizacions.style.display= 'flex'

                      facebooks.style.display = 'none';
                        tiktoks.style.display = 'none';
                        instagrams.style.display = 'none';
                        youtubes.style.display = 'none';
                        spotifys.style.display = 'none';
                        twitters.style.display = 'none';
                        Digitaless.style.display = 'none';
                        verificacions.style.display = 'none';
                    }
                  }

                </script>

              </div>
            <div class="form-floating text-dark mt-5">
              <span class="text-info"><b>Link</b></span>
              <input type="text" name="link" class="form-control email text-info bg-dark" required>
            </div>
            <div class="form-floating text-dark mt-5">
              <span class="text-info"><b>Cantidad</b></span>
                <input type="number" id="cantidad" name="cantidad" class="form-control email text-info bg-dark" required>
              </div>

              <div class="form-floating text-dark mt-5">
                <span class="text-info"><b>Precio</b></span> <br>
                <input type="button" id="calcular" class="btn btn-success mt-2" value="Calcular precio">

                <p class="text-success mt-3"><b>$ 
                <input type="number" id="preciofinal" class="text-center" required disabled>

                  
                  <script>
                    // Click precio
                    var cantidad = document.getElementById('cantidad')
                    var calcular = document.getElementById('calcular')
                    var preciofinal = document.getElementById('preciofinal')
                    preciofinal.style.background='transparent'
                    preciofinal.style.border='none'
                    preciofinal.style.color='white'



                    calcular.addEventListener("click", function() {

                      var contenedorservicios = document.getElementById('contenedorservicios');

                      
                        for (var i = 0; i < contenedorservicios.children.length; i++) {
                                var child = contenedorservicios.children[i];
                                if(child.style.display=='flex'){
                                  console.log(child.value)

                                  var precio = "";
                                  var primerEspacio=false;


                                for (i =0; i <= (child.value.length -1); i++) { 
                                  
                                  if(child.value[i]==' '){
                                    primerEspacio=true;
                                  }
                                  if(primerEspacio==true){
                                    precio+=child.value[i]
                                  }
                                }
                                preciofinal.text =precio*cantidad.value
                                preciofinal.value =precio*cantidad.value

                                  


                                  
                                }
                          }

                        })
                  </script>
              </b></p>
              </div>

              

              <div class="d-flex justify-content-center">
                <div class="btn btn-primary btn-rounded mt-5">
                    <label class="form-label text-white m-1" for="customFile2">Añadir imagen 1</label> 
                    <input type="file" name="img"  required/>
                </div>
            </div><span class="mt-2 text-danger">Obligatorio</span>

            <div class="d-flex justify-content-center">
              <div class="btn btn-primary btn-rounded mt-5">
                  <label class="form-label text-white m-1" for="customFile2">Añadir imagen 2</label> 
                  <input type="file" name="img2"   />
              </div>
          </div><span class="mt-2 text-white">Opcional</span>

          <div class="d-flex justify-content-center">
            <div class="btn btn-primary btn-rounded mt-5">
                <label class="form-label text-white m-1" for="customFile2">Añadir imagen 3</label> 
                <input type="file" name="img3"  />
            </div>
        </div><span class="mt-2 text-white">Opcional</span>

          
      
    
            <div class="help">
            
        
            </div>

            <input type="submit"  class="form-control w-100 mt-4 btn btn-lg btn-info" value="Comprar"  />

                
    
           
          </form>
          <br>
    </div>



<%- include ("./partials/footer") %> 
<%- include ("./partials/pie") %> 